version: '3.9'
services:
  postgresDB:
    image: postgres:latest
    environment:
      POSTGRES_DB: keycloak
      POSTGRES_USER: keycloak
      POSTGRES_PASSWORD: keycloak
    volumes:
      - ./project/create.sql:/docker-entrypoint-initdb.d/create.sql
      - ./postgres_data:/var/lib/postgresql/data/
    ports:
      - 5432:5432
    networks:
      - keycloak_network
    command: ["postgres", "-c", "log_statement=all"]

  keycloak:
    image: quay.io/keycloak/keycloak:legacy
    environment:
      DB_VENDOR: POSTGRES
      DB_ADDR: postgresDB:5432  # Corrigido para apontar para o servi√ßo postgresDB na porta 5432
      DB_DATABASE: keycloak
      DB_USER: keycloak
      DB_PASSWORD: keycloak
      KEYCLOAK_USER: admin
      KEYCLOAK_PASSWORD: admin
    ports:
      - 8080:8080
    depends_on:
      - postgresDB
    networks:
      - keycloak_network

  app:
    build: 
      context: ./project
    ports:
      - 3005:3000
    volumes:
      - ./project:/home/node/app
    depends_on:
      - postgresDB
    networks:
      - keycloak_network

networks:
  keycloak_network:
    driver: bridge
